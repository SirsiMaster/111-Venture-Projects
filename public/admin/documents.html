<!DOCTYPE html>
<html lang="en" data-auth-protect="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Document Vault â€” FinalWishes</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../finalwishes.css">
    
</head>
<body>
    <div class="admin-wrapper">
        <div id="sidebar-root" data-active="documents"></div>
        
        <main class="main-content">
            <header id="universal-header-root" 
                    data-title="Document Vault" 
                    data-subtitle="Secure document storage and management"
                    data-search-placeholder="Search documents by name, type, or estate..."></header>
            
            <div class="page-content">
                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button class="btn btn-primary" onclick="showUploadModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Upload Document
                        </button>
                        <div class="filter-group">
                            <select id="typeFilter" class="form-select" onchange="filterDocuments()">
                                <option value="">All Types</option>
                                <option value="will">Will</option>
                                <option value="trust">Trust</option>
                                <option value="deed">Deed</option>
                                <option value="financial">Financial</option>
                                <option value="insurance">Insurance</option>
                                <option value="medical">Medical</option>
                                <option value="legal">Legal</option>
                                <option value="other">Other</option>
                            </select>
                            <select id="estateFilter" class="form-select" onchange="filterDocuments()">
                                <option value="">All Estates</option>
                            </select>
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-icon" onclick="toggleView('grid')" title="Grid view">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </button>
                        <button class="btn btn-icon active" onclick="toggleView('table')" title="Table view">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Stats Summary -->
                <div class="stats-grid mini">
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total Documents</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-size">0 MB</div>
                        <div class="stat-label">Storage Used</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-pending">0</div>
                        <div class="stat-label">Pending Review</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-encrypted">0</div>
                        <div class="stat-label">Encrypted</div>
                    </div>
                </div>
                
                <!-- Table View -->
                <div class="data-table" id="documents-table-view">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                <th onclick="sortBy('name')">Document Name <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('type')">Type <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('estateName')">Estate <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('size')">Size <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('status')">Status <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('uploadedAt')">Uploaded <span class="sort-icon">â†•</span></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="documents-table-body">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: var(--space-xl);">
                                    <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                    <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                    <div class="skeleton" style="height: 20px;"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Grid View (hidden by default) -->
                <div class="documents-grid hidden" id="documents-grid-view"></div>
                
                <div class="pagination" id="pagination"></div>
            </div>
        </main>
    </div>
    
    <!-- Upload Modal -->
    <div class="modal" id="uploadModal">
        <div class="modal-backdrop" onclick="closeUploadModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Upload Document</h2>
                <button class="modal-close" onclick="closeUploadModal()">&times;</button>
            </div>
            <form id="uploadForm" onsubmit="handleUpload(event)">
                <div class="modal-body">
                    <div class="dropzone" id="dropzone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p>Drag & drop files here or <label for="fileInput" class="link">browse</label></p>
                        <input type="file" id="fileInput" name="file" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;" onchange="handleFileSelect(event)">
                        <span class="text-muted">Supported: PDF, DOC, DOCX, JPG, PNG (max 25MB)</span>
                    </div>
                    
                    <div id="fileList" class="file-list"></div>
                    
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="docType">Document Type *</label>
                            <select id="docType" name="type" required>
                                <option value="">Select type</option>
                                <option value="will">Will</option>
                                <option value="trust">Trust</option>
                                <option value="deed">Deed</option>
                                <option value="financial">Financial</option>
                                <option value="insurance">Insurance</option>
                                <option value="medical">Medical</option>
                                <option value="legal">Legal</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="docEstate">Associated Estate *</label>
                            <select id="docEstate" name="estateId" required>
                                <option value="">Select estate</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="docDescription">Description</label>
                        <textarea id="docDescription" name="description" rows="2" placeholder="Brief description of the document..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="encrypt" name="encrypt" checked>
                            Encrypt document (recommended for sensitive files)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeUploadModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="uploadBtn" disabled>Upload</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Document Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-backdrop" onclick="closePreviewModal()"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 class="modal-title" id="previewTitle">Document Preview</h2>
                <button class="modal-close" onclick="closePreviewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="previewContainer" class="preview-container"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closePreviewModal()">Close</button>
                <button type="button" class="btn btn-primary" onclick="downloadDocument()">Download</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script src="../components/sidebar.js"></script>
    <script src="../components/universal-header.js"></script>
    
    <script type="module">
        import { DatabaseService, StorageService } from '../assets/js/firebase-init.js';
        import EstateService from '../assets/js/services/estateService.js';
        
        window.DatabaseService = DatabaseService;
        window.StorageService = StorageService;
        
        let documents = [];
        let filteredDocuments = [];
        let estates = [];
        let selectedFiles = [];
        let currentPage = 1;
        let pageSize = 10;
        let sortField = 'uploadedAt';
        let sortDirection = 'desc';
        let currentView = 'table';
        let previewingDoc = null;
        
        async function init() {
            console.log('ðŸ›ï¸ FinalWishes - Document Vault');
            await loadEstates();
            await loadDocuments();
        }
        
        async function loadEstates() {
            try {
                estates = await EstateService.getAllEstates();
                const selects = ['estateFilter', 'docEstate'];
                selects.forEach(id => {
                    const select = document.getElementById(id);
                    if (id === 'estateFilter') {
                        select.innerHTML = '<option value="">All Estates</option>' +
                            estates.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
                    } else {
                        select.innerHTML = '<option value="">Select estate</option>' +
                            estates.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
                    }
                });
            } catch (error) {
                console.error('Error loading estates:', error);
            }
        }
        
        async function loadDocuments() {
            try {
                documents = await DatabaseService.getDocuments('documents');
                filteredDocuments = [...documents];
                updateStats();
                renderDocuments();
            } catch (error) {
                console.error('Error loading documents:', error);
                showToast('Failed to load documents', 'error');
            }
        }
        
        function updateStats() {
            document.getElementById('stat-total').textContent = documents.length;
            const totalSize = documents.reduce((sum, d) => sum + (d.size || 0), 0);
            document.getElementById('stat-size').textContent = formatSize(totalSize);
            document.getElementById('stat-pending').textContent = documents.filter(d => d.status === 'pending').length;
            document.getElementById('stat-encrypted').textContent = documents.filter(d => d.encrypted).length;
        }
        
        function renderDocuments() {
            if (currentView === 'table') {
                renderTableView();
            } else {
                renderGridView();
            }
            renderPagination();
        }
        
        function renderTableView() {
            const tbody = document.getElementById('documents-table-body');
            const start = (currentPage - 1) * pageSize;
            const pageDocuments = filteredDocuments.slice(start, start + pageSize);
            
            if (pageDocuments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: var(--space-xl);">
                            <div style="color: var(--text-secondary);">No documents found.</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = pageDocuments.map(doc => {
                const estate = estates.find(e => e.id === doc.estateId);
                const uploadedAt = doc.uploadedAt?.toDate?.() || new Date(doc.uploadedAt);
                const dateStr = uploadedAt.toLocaleDateString();
                const statusClass = getStatusClass(doc.status);
                const typeClass = getTypeClass(doc.type);
                
                return `
                    <tr>
                        <td><input type="checkbox" class="doc-checkbox" data-id="${doc.id}"></td>
                        <td>
                            <div class="document-info">
                                ${getFileIcon(doc.mimeType)}
                                <div>
                                    <strong>${doc.name}</strong>
                                    ${doc.encrypted ? '<span class="badge badge-success mini">ðŸ”’</span>' : ''}
                                </div>
                            </div>
                        </td>
                        <td><span class="badge ${typeClass}">${capitalize(doc.type)}</span></td>
                        <td>${estate?.name || 'â€”'}</td>
                        <td>${formatSize(doc.size)}</td>
                        <td><span class="badge ${statusClass}">${capitalize(doc.status || 'active')}</span></td>
                        <td>${dateStr}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-sm" onclick="previewDocument('${doc.id}')" title="Preview">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                <button class="btn btn-icon btn-sm" onclick="downloadDoc('${doc.id}')" title="Download">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </button>
                                <button class="btn btn-icon btn-sm btn-danger" onclick="deleteDoc('${doc.id}')" title="Delete">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderGridView() {
            const grid = document.getElementById('documents-grid-view');
            const start = (currentPage - 1) * pageSize;
            const pageDocuments = filteredDocuments.slice(start, start + pageSize);
            
            if (pageDocuments.length === 0) {
                grid.innerHTML = `<div class="empty-state"><p>No documents found.</p></div>`;
                return;
            }
            
            grid.innerHTML = pageDocuments.map(doc => {
                const estate = estates.find(e => e.id === doc.estateId);
                const typeClass = getTypeClass(doc.type);
                
                return `
                    <div class="document-card" onclick="previewDocument('${doc.id}')">
                        <div class="document-card-icon">
                            ${getFileIcon(doc.mimeType, 48)}
                        </div>
                        <div class="document-card-body">
                            <h4>${doc.name}</h4>
                            <span class="badge ${typeClass}">${capitalize(doc.type)}</span>
                            <p class="text-muted">${estate?.name || 'No estate'}</p>
                            <p class="text-muted">${formatSize(doc.size)}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderPagination() {
            const totalPages = Math.ceil(filteredDocuments.length / pageSize);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            pagination.innerHTML = `
                <button class="btn btn-sm btn-secondary" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">Previous</button>
                <span class="pagination-info">Page ${currentPage} of ${totalPages}</span>
                <button class="btn btn-sm btn-secondary" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">Next</button>
            `;
        }
        
        // Filter and sort
        window.filterDocuments = function() {
            const type = document.getElementById('typeFilter').value;
            const estateId = document.getElementById('estateFilter').value;
            
            filteredDocuments = documents.filter(doc => {
                if (type && doc.type !== type) return false;
                if (estateId && doc.estateId !== estateId) return false;
                return true;
            });
            
            currentPage = 1;
            renderDocuments();
        };
        
        window.sortBy = function(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }
            
            filteredDocuments.sort((a, b) => {
                let aVal = a[field] || '';
                let bVal = b[field] || '';
                if (field === 'size') {
                    aVal = Number(aVal) || 0;
                    bVal = Number(bVal) || 0;
                }
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            renderDocuments();
        };
        
        window.toggleView = function(view) {
            currentView = view;
            document.getElementById('documents-table-view').classList.toggle('hidden', view !== 'table');
            document.getElementById('documents-grid-view').classList.toggle('hidden', view !== 'grid');
            document.querySelectorAll('.toolbar-right .btn-icon').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.btn-icon').classList.add('active');
            renderDocuments();
        };
        
        window.goToPage = function(page) {
            currentPage = page;
            renderDocuments();
        };
        
        window.toggleSelectAll = function() {
            const checked = document.getElementById('selectAll').checked;
            document.querySelectorAll('.doc-checkbox').forEach(cb => cb.checked = checked);
        };
        
        // Upload functionality
        window.showUploadModal = function() {
            selectedFiles = [];
            document.getElementById('uploadForm').reset();
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('uploadModal').classList.add('open');
        };
        
        window.closeUploadModal = function() {
            document.getElementById('uploadModal').classList.remove('open');
        };
        
        window.handleDragOver = function(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        };
        
        window.handleDragLeave = function(e) {
            e.currentTarget.classList.remove('dragover');
        };
        
        window.handleDrop = function(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            addFiles(files);
        };
        
        window.handleFileSelect = function(e) {
            const files = Array.from(e.target.files);
            addFiles(files);
        };
        
        function addFiles(files) {
            const maxSize = 25 * 1024 * 1024; // 25MB
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'];
            
            files.forEach(file => {
                if (file.size > maxSize) {
                    showToast(`${file.name} is too large (max 25MB)`, 'error');
                    return;
                }
                if (!validTypes.includes(file.type)) {
                    showToast(`${file.name} has unsupported format`, 'error');
                    return;
                }
                selectedFiles.push(file);
            });
            
            updateFileList();
        }
        
        function updateFileList() {
            const list = document.getElementById('fileList');
            if (selectedFiles.length === 0) {
                list.innerHTML = '';
                document.getElementById('uploadBtn').disabled = true;
                return;
            }
            
            list.innerHTML = selectedFiles.map((file, i) => `
                <div class="file-item">
                    <span>${file.name} (${formatSize(file.size)})</span>
                    <button type="button" class="btn btn-icon btn-sm" onclick="removeFile(${i})">&times;</button>
                </div>
            `).join('');
            
            document.getElementById('uploadBtn').disabled = false;
        }
        
        window.removeFile = function(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        };
        
        window.handleUpload = async function(e) {
            e.preventDefault();
            if (selectedFiles.length === 0) return;
            
            const form = e.target;
            const estateId = form.estateId.value;
            const type = form.type.value;
            const description = form.description.value;
            const encrypt = form.encrypt.checked;
            
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('uploadBtn').textContent = 'Uploading...';
            
            try {
                for (const file of selectedFiles) {
                    // Upload to Firebase Storage
                    const path = `documents/${estateId}/${Date.now()}_${file.name}`;
                    const downloadURL = await StorageService.uploadFile(path, file);
                    
                    // Create document record
                    await DatabaseService.createDocument('documents', {
                        name: file.name,
                        type,
                        description,
                        estateId,
                        size: file.size,
                        mimeType: file.type,
                        path,
                        downloadURL,
                        encrypted: encrypt,
                        status: 'active',
                        uploadedAt: new Date(),
                        uploadedBy: window.AuthService?.getCurrentUser?.()?.uid || 'admin',
                    });
                }
                
                showToast(`${selectedFiles.length} document(s) uploaded successfully`, 'success');
                closeUploadModal();
                await loadDocuments();
            } catch (error) {
                console.error('Error uploading:', error);
                showToast('Failed to upload documents', 'error');
            } finally {
                document.getElementById('uploadBtn').disabled = false;
                document.getElementById('uploadBtn').textContent = 'Upload';
            }
        };
        
        // Preview and download
        window.previewDocument = function(id) {
            previewingDoc = documents.find(d => d.id === id);
            if (!previewingDoc) return;
            
            document.getElementById('previewTitle').textContent = previewingDoc.name;
            const container = document.getElementById('previewContainer');
            
            if (previewingDoc.mimeType?.startsWith('image/')) {
                container.innerHTML = `<img src="${previewingDoc.downloadURL}" alt="${previewingDoc.name}" style="max-width: 100%; max-height: 70vh;">`;
            } else if (previewingDoc.mimeType === 'application/pdf') {
                container.innerHTML = `<iframe src="${previewingDoc.downloadURL}" style="width: 100%; height: 70vh; border: none;"></iframe>`;
            } else {
                container.innerHTML = `<div class="preview-placeholder"><p>Preview not available for this file type.</p><p>Click "Download" to view the document.</p></div>`;
            }
            
            document.getElementById('previewModal').classList.add('open');
        };
        
        window.closePreviewModal = function() {
            document.getElementById('previewModal').classList.remove('open');
            previewingDoc = null;
        };
        
        window.downloadDocument = window.downloadDoc = async function(id) {
            const doc = id ? documents.find(d => d.id === id) : previewingDoc;
            if (!doc?.downloadURL) return;
            
            const a = document.createElement('a');
            a.href = doc.downloadURL;
            a.download = doc.name;
            a.target = '_blank';
            a.click();
        };
        
        window.deleteDoc = async function(id) {
            if (!confirm('Are you sure you want to delete this document?')) return;
            
            try {
                const doc = documents.find(d => d.id === id);
                if (doc?.path) {
                    await StorageService.deleteFile(doc.path);
                }
                await DatabaseService.deleteDocument('documents', id);
                showToast('Document deleted successfully', 'success');
                await loadDocuments();
            } catch (error) {
                console.error('Error deleting document:', error);
                showToast('Failed to delete document', 'error');
            }
        };
        
        // Utility functions
        function capitalize(str) {
            return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
        }
        
        function formatSize(bytes) {
            if (!bytes) return '0 B';
            const units = ['B', 'KB', 'MB', 'GB'];
            let i = 0;
            while (bytes >= 1024 && i < units.length - 1) {
                bytes /= 1024;
                i++;
            }
            return `${bytes.toFixed(1)} ${units[i]}`;
        }
        
        function getStatusClass(status) {
            const map = { active: 'badge-success', pending: 'badge-warning', archived: 'badge-neutral' };
            return map[status] || 'badge-neutral';
        }
        
        function getTypeClass(type) {
            const map = { will: 'badge-gold', trust: 'badge-info', deed: 'badge-success', financial: 'badge-warning', legal: 'badge-danger' };
            return map[type] || 'badge-neutral';
        }
        
        function getFileIcon(mimeType, size = 16) {
            const icons = {
                'application/pdf': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>`,
                'image/': `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>`,
            };
            if (mimeType?.startsWith('image/')) return icons['image/'];
            return icons[mimeType] || `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>`;
        }
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
