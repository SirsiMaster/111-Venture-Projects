<!DOCTYPE html>
<html lang="en" data-auth-protect="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Development Dashboard ‚Äî Legacy Estate OS</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../../legacy.css">
    <link rel="stylesheet" href="../../assets/css/admin-layout.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="admin-wrapper">
        <div id="sidebar-root" data-active="dev-dashboard"></div>
        
        <main class="main-content">
            <header id="universal-header-root" 
                    data-title="Development Dashboard" 
                    data-subtitle="AI-Agentic development metrics and progress tracking"
                    data-search-placeholder="Search development logs..."></header>
            
            <div class="page-content">
                <!-- Quick Actions -->
                <div class="quick-actions mb-lg">
                    <button class="btn btn-primary" onclick="logSession()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Log Session
                    </button>
                    <a href="analytics.html" class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        Analytics
                    </a>
                    <a href="costs.html" class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Costs
                    </a>
                    <button class="btn btn-secondary" onclick="syncGitHub()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                        </svg>
                        Sync GitHub
                    </button>
                </div>
                
                <!-- Main Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-icon gold">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        <div class="stat-value" id="total-hours">0</div>
                        <div class="stat-label">Total Hours</div>
                        <div class="stat-change positive" id="hours-today">+0 today</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="4"></circle>
                                <line x1="1.05" y1="12" x2="7" y2="12"></line>
                                <line x1="17.01" y1="12" x2="22.96" y2="12"></line>
                            </svg>
                        </div>
                        <div class="stat-value" id="total-commits">0</div>
                        <div class="stat-label">Commits</div>
                        <div class="stat-change" id="commits-today">+0 today</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                        </div>
                        <div class="stat-value" id="files-changed">0</div>
                        <div class="stat-label">Files Changed</div>
                        <div class="stat-change" id="files-today">+0 today</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-value" id="total-cost">$0</div>
                        <div class="stat-label">Total Cost</div>
                        <div class="stat-change" id="cost-today">+$0 today</div>
                    </div>
                </div>
                
                <!-- Progress & Velocity Row -->
                <div class="row-2">
                    <!-- Project Progress -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Project Progress</h3>
                            <span class="badge badge-gold" id="completion-badge">0%</span>
                        </div>
                        <div class="card-body">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                            </div>
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <span class="stat-value" id="completed-tasks">0</span>
                                    <span class="stat-label">Completed</span>
                                </div>
                                <div class="progress-stat">
                                    <span class="stat-value" id="in-progress-tasks">0</span>
                                    <span class="stat-label">In Progress</span>
                                </div>
                                <div class="progress-stat">
                                    <span class="stat-value" id="remaining-tasks">0</span>
                                    <span class="stat-label">Remaining</span>
                                </div>
                            </div>
                            <div class="milestone-list" id="milestones">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Velocity Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Development Velocity</h3>
                            <select id="velocityRange" class="form-select mini" onchange="updateVelocityChart()">
                                <option value="7">Last 7 days</option>
                                <option value="14">Last 14 days</option>
                                <option value="30">Last 30 days</option>
                            </select>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 200px;">
                                <canvas id="velocityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Today's Activity & Resource Usage -->
                <div class="row-2">
                    <!-- Today's Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Today's Activity</h3>
                            <span class="badge badge-success" id="session-status">Active</span>
                        </div>
                        <div class="card-body">
                            <div class="activity-summary">
                                <div class="activity-stat">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <span id="today-hours">0h</span>
                                    <span class="label">Hours</span>
                                </div>
                                <div class="activity-stat">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="4"></circle>
                                        <line x1="1.05" y1="12" x2="7" y2="12"></line>
                                        <line x1="17.01" y1="12" x2="22.96" y2="12"></line>
                                    </svg>
                                    <span id="today-commits">0</span>
                                    <span class="label">Commits</span>
                                </div>
                                <div class="activity-stat">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    </svg>
                                    <span id="today-files">0</span>
                                    <span class="label">Files</span>
                                </div>
                                <div class="activity-stat">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="4 17 10 11 4 5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                    <span id="today-lines">0</span>
                                    <span class="label">Lines</span>
                                </div>
                            </div>
                            
                            <h4 class="subsection-title">Recent Commits</h4>
                            <div class="commit-list" id="recent-commits">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resource Usage -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Resource Usage</h3>
                        </div>
                        <div class="card-body">
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>Storage</span>
                                    <span id="storage-usage">2.4 GB / 100 GB</span>
                                </div>
                                <div class="resource-bar">
                                    <div class="resource-fill" id="storage-bar" style="width: 2.4%"></div>
                                </div>
                            </div>
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>API Calls (Monthly)</span>
                                    <span id="api-usage">1,247 / 10,000</span>
                                </div>
                                <div class="resource-bar">
                                    <div class="resource-fill" id="api-bar" style="width: 12.47%"></div>
                                </div>
                            </div>
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>Firebase Functions</span>
                                    <span id="functions-usage">423 / 2,000,000</span>
                                </div>
                                <div class="resource-bar">
                                    <div class="resource-fill success" id="functions-bar" style="width: 0.02%"></div>
                                </div>
                            </div>
                            <div class="resource-item">
                                <div class="resource-header">
                                    <span>AI Tokens (Daily)</span>
                                    <span id="ai-usage">45,231 / 100,000</span>
                                </div>
                                <div class="resource-bar">
                                    <div class="resource-fill warning" id="ai-bar" style="width: 45.2%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Development Log -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Development Sessions</h3>
                        <a href="reports.html" class="btn btn-sm btn-secondary">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Duration</th>
                                        <th>Commits</th>
                                        <th>Files</th>
                                        <th>Lines +/-</th>
                                        <th>Cost</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="sessions-table">
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: var(--space-xl);">
                                            <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                            <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                            <div class="skeleton" style="height: 20px;"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Log Session Modal -->
    <div class="modal" id="sessionModal">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Log Development Session</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="sessionForm" onsubmit="handleSessionSubmit(event)">
                <div class="modal-body">
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="sessionDate">Date</label>
                            <input type="date" id="sessionDate" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="sessionHours">Hours Worked</label>
                            <input type="number" id="sessionHours" name="hours" required min="0.25" max="24" step="0.25" placeholder="e.g., 4.5">
                        </div>
                    </div>
                    <div class="form-row three-col">
                        <div class="form-group">
                            <label for="sessionCommits">Commits</label>
                            <input type="number" id="sessionCommits" name="commits" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="sessionFiles">Files Changed</label>
                            <input type="number" id="sessionFiles" name="files" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="sessionLines">Lines +/-</label>
                            <input type="number" id="sessionLines" name="lines" value="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sessionAgent">Agent/Domain</label>
                        <select id="sessionAgent" name="agent">
                            <option value="general">General</option>
                            <option value="auth">Auth Agent</option>
                            <option value="estate">Estate Agent</option>
                            <option value="vault">Vault Agent</option>
                            <option value="compliance">Compliance Agent</option>
                            <option value="notify">Notify Agent</option>
                            <option value="llm">LLM Agent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sessionNotes">Notes / Work Completed</label>
                        <textarea id="sessionNotes" name="notes" rows="4" placeholder="Describe what was accomplished..."></textarea>
                    </div>
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="sessionRetries">Failed Attempts / Retries</label>
                            <input type="number" id="sessionRetries" name="retries" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="hourlyRate">Hourly Rate ($)</label>
                            <input type="number" id="hourlyRate" name="rate" min="0" value="150" step="10">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Log Session</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script src="../../components/sidebar.js"></script>
    <script src="../../components/universal-header.js"></script>
    
    <script type="module">
        import { DatabaseService } from '../../assets/js/firebase-init.js';
        import DevelopmentMetricsService from '../../assets/js/services/developmentMetricsService.js';
        
        window.DatabaseService = DatabaseService;
        window.MetricsService = DevelopmentMetricsService;
        
        let sessions = [];
        let velocityChart = null;
        
        // Milestones definition
        const milestones = [
            { name: 'Phase 1: Foundation', target: 'auth', status: 'complete', progress: 100 },
            { name: 'Phase 2: Core Features', target: 'estate', status: 'in-progress', progress: 75 },
            { name: 'Phase 3: Document Vault', target: 'vault', status: 'in-progress', progress: 40 },
            { name: 'Phase 4: Compliance', target: 'compliance', status: 'pending', progress: 0 },
            { name: 'Phase 5: Notifications', target: 'notify', status: 'pending', progress: 0 },
            { name: 'Phase 6: AI Integration', target: 'llm', status: 'pending', progress: 0 },
        ];
        
        async function init() {
            console.log('üèõÔ∏è Legacy Estate OS - Development Dashboard');
            
            // Set today's date as default
            document.getElementById('sessionDate').valueAsDate = new Date();
            
            await loadMetrics();
            await loadSessions();
            initVelocityChart();
            renderMilestones();
        }
        
        async function loadMetrics() {
            try {
                const metrics = await DevelopmentMetricsService.getProjectTotals();
                const todayMetrics = await DevelopmentMetricsService.getTodayMetrics();
                
                // Update stats
                document.getElementById('total-hours').textContent = metrics.totalHours.toFixed(1);
                document.getElementById('total-commits').textContent = metrics.totalCommits;
                document.getElementById('files-changed').textContent = metrics.totalFiles;
                document.getElementById('total-cost').textContent = '$' + metrics.totalCost.toLocaleString();
                
                // Today's stats
                document.getElementById('hours-today').textContent = `+${todayMetrics.hours}h today`;
                document.getElementById('commits-today').textContent = `+${todayMetrics.commits} today`;
                document.getElementById('files-today').textContent = `+${todayMetrics.files} today`;
                document.getElementById('cost-today').textContent = `+$${todayMetrics.cost} today`;
                
                // Today's activity summary
                document.getElementById('today-hours').textContent = todayMetrics.hours + 'h';
                document.getElementById('today-commits').textContent = todayMetrics.commits;
                document.getElementById('today-files').textContent = todayMetrics.files;
                document.getElementById('today-lines').textContent = todayMetrics.lines;
                
                // Progress
                const completion = metrics.completion || 35;
                document.getElementById('completion-badge').textContent = completion + '%';
                document.getElementById('progress-bar').style.width = completion + '%';
                document.getElementById('completed-tasks').textContent = metrics.completedTasks || 28;
                document.getElementById('in-progress-tasks').textContent = metrics.inProgressTasks || 12;
                document.getElementById('remaining-tasks').textContent = metrics.remainingTasks || 40;
                
            } catch (error) {
                console.error('Error loading metrics:', error);
                // Use fallback data
                setFallbackMetrics();
            }
        }
        
        function setFallbackMetrics() {
            // Fallback data for demo
            document.getElementById('total-hours').textContent = '247.5';
            document.getElementById('total-commits').textContent = '156';
            document.getElementById('files-changed').textContent = '423';
            document.getElementById('total-cost').textContent = '$37,125';
            document.getElementById('hours-today').textContent = '+4.5h today';
            document.getElementById('commits-today').textContent = '+8 today';
            document.getElementById('files-today').textContent = '+23 today';
            document.getElementById('cost-today').textContent = '+$675 today';
            document.getElementById('completion-badge').textContent = '35%';
            document.getElementById('progress-bar').style.width = '35%';
            document.getElementById('completed-tasks').textContent = '28';
            document.getElementById('in-progress-tasks').textContent = '12';
            document.getElementById('remaining-tasks').textContent = '40';
        }
        
        async function loadSessions() {
            try {
                sessions = await DevelopmentMetricsService.getAllSessions(10);
                renderSessions();
                renderRecentCommits();
            } catch (error) {
                console.error('Error loading sessions:', error);
                renderFallbackSessions();
            }
        }
        
        function renderSessions() {
            const tbody = document.getElementById('sessions-table');
            
            if (sessions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: var(--space-xl);">
                            No sessions logged yet. Click "Log Session" to start tracking.
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = sessions.map(s => {
                const date = s.date?.toDate?.() || new Date(s.date);
                const dateStr = date.toLocaleDateString();
                const cost = (s.hours * (s.rate || 150)).toLocaleString();
                const linesClass = (s.lines || 0) >= 0 ? 'positive' : 'negative';
                
                return `
                    <tr>
                        <td>${dateStr}</td>
                        <td>${s.hours}h</td>
                        <td>${s.commits || 0}</td>
                        <td>${s.files || 0}</td>
                        <td class="${linesClass}">${s.lines >= 0 ? '+' : ''}${s.lines || 0}</td>
                        <td>$${cost}</td>
                        <td class="truncate" title="${s.notes || ''}">${s.notes || '‚Äî'}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderFallbackSessions() {
            const tbody = document.getElementById('sessions-table');
            tbody.innerHTML = `
                <tr><td>11/26/2025</td><td>4.5h</td><td>8</td><td>23</td><td class="positive">+547</td><td>$675</td><td>Admin dashboard implementation</td></tr>
                <tr><td>11/25/2025</td><td>6.0h</td><td>12</td><td>31</td><td class="positive">+892</td><td>$900</td><td>Estate service, Firebase integration</td></tr>
                <tr><td>11/24/2025</td><td>5.5h</td><td>9</td><td>18</td><td class="positive">+423</td><td>$825</td><td>Component library foundation</td></tr>
                <tr><td>11/23/2025</td><td>3.0h</td><td>5</td><td>12</td><td class="positive">+234</td><td>$450</td><td>Auth system setup</td></tr>
                <tr><td>11/22/2025</td><td>7.0h</td><td>15</td><td>42</td><td class="positive">+1,203</td><td>$1,050</td><td>Initial project setup, architecture</td></tr>
            `;
        }
        
        function renderRecentCommits() {
            const container = document.getElementById('recent-commits');
            
            // Sample commits - would come from GitHub API in production
            const commits = [
                { message: 'feat: Add development metrics dashboard', time: '2h ago', files: 5 },
                { message: 'fix: Firebase auth session handling', time: '3h ago', files: 2 },
                { message: 'feat: Implement estate CRUD operations', time: '4h ago', files: 4 },
                { message: 'style: Update admin layout CSS', time: '5h ago', files: 1 },
            ];
            
            container.innerHTML = commits.map(c => `
                <div class="commit-item">
                    <div class="commit-message">${c.message}</div>
                    <div class="commit-meta">
                        <span>${c.time}</span>
                        <span>${c.files} files</span>
                    </div>
                </div>
            `).join('');
        }
        
        function renderMilestones() {
            const container = document.getElementById('milestones');
            
            container.innerHTML = milestones.map(m => {
                const statusClass = m.status === 'complete' ? 'badge-success' : 
                                   m.status === 'in-progress' ? 'badge-warning' : 'badge-neutral';
                const statusText = m.status === 'complete' ? '‚úì' : 
                                  m.status === 'in-progress' ? `${m.progress}%` : 'Pending';
                
                return `
                    <div class="milestone-item">
                        <div class="milestone-info">
                            <span class="milestone-name">${m.name}</span>
                            <span class="badge ${statusClass} mini">${statusText}</span>
                        </div>
                        <div class="milestone-bar">
                            <div class="milestone-fill" style="width: ${m.progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function initVelocityChart() {
            const ctx = document.getElementById('velocityChart')?.getContext('2d');
            if (!ctx) return;
            
            const days = 7;
            const labels = [];
            const hoursData = [];
            const commitsData = [];
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en', { weekday: 'short' }));
                hoursData.push(Math.random() * 6 + 2);
                commitsData.push(Math.floor(Math.random() * 10 + 2));
            }
            
            velocityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'Hours',
                            data: hoursData,
                            backgroundColor: 'rgba(212, 175, 55, 0.8)',
                            yAxisID: 'y',
                        },
                        {
                            label: 'Commits',
                            data: commitsData,
                            type: 'line',
                            borderColor: '#1e3a8a',
                            backgroundColor: 'rgba(30, 58, 138, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Hours' } },
                        y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Commits' }, grid: { drawOnChartArea: false } }
                    }
                }
            });
        }
        
        window.updateVelocityChart = function() {
            // Would fetch new data and update chart
            const days = parseInt(document.getElementById('velocityRange').value);
            console.log('Update velocity chart for', days, 'days');
        };
        
        // Modal functions
        window.logSession = function() {
            document.getElementById('sessionModal').classList.add('open');
        };
        
        window.closeModal = function() {
            document.getElementById('sessionModal').classList.remove('open');
        };
        
        window.handleSessionSubmit = async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const data = {
                date: new Date(form.date.value),
                hours: parseFloat(form.hours.value),
                commits: parseInt(form.commits.value) || 0,
                files: parseInt(form.files.value) || 0,
                lines: parseInt(form.lines.value) || 0,
                agent: form.agent.value,
                notes: form.notes.value,
                retries: parseInt(form.retries.value) || 0,
                rate: parseFloat(form.rate.value) || 150,
            };
            
            try {
                await DevelopmentMetricsService.logSession(data);
                showToast('Session logged successfully', 'success');
                closeModal();
                await loadMetrics();
                await loadSessions();
            } catch (error) {
                console.error('Error logging session:', error);
                showToast('Failed to log session', 'error');
            }
        };
        
        window.syncGitHub = async function() {
            showToast('Syncing with GitHub...', 'info');
            try {
                await DevelopmentMetricsService.syncGitHubData();
                showToast('GitHub sync complete', 'success');
                await loadMetrics();
            } catch (error) {
                console.error('GitHub sync failed:', error);
                showToast('GitHub sync failed', 'error');
            }
        };
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
