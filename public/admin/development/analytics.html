<!DOCTYPE html>
<html lang="en" data-auth-protect="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Development Analytics â€” FinalWishes</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../../finalwishes.css">
    
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="admin-wrapper">
        <div id="sidebar-root" data-active="dev-analytics"></div>
        
        <main class="main-content">
            <header id="universal-header-root" 
                    data-title="Development Analytics" 
                    data-subtitle="Detailed metrics, trends, and performance insights"
                    data-search-placeholder="Search analytics..."></header>
            
            <div class="page-content">
                <!-- Time Range Selector -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <select id="timeRange" class="form-select" onchange="updateAnalytics()">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                            <option value="all">All time</option>
                        </select>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-secondary" onclick="exportAnalytics()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export Report
                        </button>
                    </div>
                </div>
                
                <!-- KPI Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Avg Hours/Day</div>
                        <div class="stat-value" id="avg-hours">4.5</div>
                        <div class="stat-change positive">+12% vs prev period</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Commits/Day</div>
                        <div class="stat-value" id="avg-commits">6.2</div>
                        <div class="stat-change positive">+8% vs prev period</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Velocity Score</div>
                        <div class="stat-value" id="velocity-score">87</div>
                        <div class="stat-change positive">Good</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Efficiency Index</div>
                        <div class="stat-value" id="efficiency-index">0.94</div>
                        <div class="stat-change positive">Above target</div>
                    </div>
                </div>
                
                <!-- Main Charts -->
                <div class="row-2">
                    <!-- Activity Trend -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Activity Trend</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Productivity Metrics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Productivity Metrics</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="productivityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Agent Performance -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Agent/Domain Performance</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="agentChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Metrics -->
                <div class="row-2">
                    <!-- Lines of Code -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Code Volume</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric-grid">
                                <div class="metric-item">
                                    <span class="metric-value positive">+12,450</span>
                                    <span class="metric-label">Lines Added</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value negative">-2,340</span>
                                    <span class="metric-label">Lines Removed</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">+10,110</span>
                                    <span class="metric-label">Net Change</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">423</span>
                                    <span class="metric-label">Files Modified</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quality Metrics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Quality Indicators</h3>
                        </div>
                        <div class="card-body">
                            <div class="metric-grid">
                                <div class="metric-item">
                                    <span class="metric-value">3.2%</span>
                                    <span class="metric-label">Retry Rate</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">156</span>
                                    <span class="metric-label">Total Commits</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">78</span>
                                    <span class="metric-label">Avg Lines/Commit</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-value">2.7</span>
                                    <span class="metric-label">Files/Commit</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Time Distribution -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Time Distribution by Day</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="timeDistChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script src="../../components/sidebar.js"></script>
    <script src="../../components/universal-header.js"></script>
    
    <script type="module">
        import DevelopmentMetricsService from '../../assets/js/services/developmentMetricsService.js';
        
        let activityChart, productivityChart, agentChart, timeDistChart;
        
        async function init() {
            console.log('ðŸ›ï¸ FinalWishes - Development Analytics');
            initCharts();
        }
        
        function initCharts() {
            // Activity trend chart
            const activityCtx = document.getElementById('activityChart')?.getContext('2d');
            if (activityCtx) {
                const labels = [];
                const hoursData = [];
                const commitsData = [];
                
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    labels.push(date.toLocaleDateString('en', { month: 'short', day: 'numeric' }));
                    hoursData.push(Math.random() * 6 + 2);
                    commitsData.push(Math.floor(Math.random() * 10 + 2));
                }
                
                activityChart = new Chart(activityCtx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            {
                                label: 'Hours',
                                data: hoursData,
                                borderColor: '#D4AF37',
                                backgroundColor: 'rgba(212, 175, 55, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y',
                            },
                            {
                                label: 'Commits',
                                data: commitsData,
                                borderColor: '#1e3a8a',
                                backgroundColor: 'rgba(30, 58, 138, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y1',
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: { legend: { position: 'top' } },
                        scales: {
                            y: { type: 'linear', position: 'left', title: { display: true, text: 'Hours' } },
                            y1: { type: 'linear', position: 'right', title: { display: true, text: 'Commits' }, grid: { drawOnChartArea: false } }
                        }
                    }
                });
            }
            
            // Productivity radar chart
            const productivityCtx = document.getElementById('productivityChart')?.getContext('2d');
            if (productivityCtx) {
                productivityChart = new Chart(productivityCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Code Volume', 'Commit Frequency', 'Session Length', 'Quality', 'Velocity', 'Efficiency'],
                        datasets: [{
                            label: 'Current',
                            data: [85, 78, 92, 88, 75, 90],
                            borderColor: '#D4AF37',
                            backgroundColor: 'rgba(212, 175, 55, 0.2)',
                        }, {
                            label: 'Target',
                            data: [80, 80, 80, 80, 80, 80],
                            borderColor: '#1e3a8a',
                            backgroundColor: 'rgba(30, 58, 138, 0.1)',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top' } },
                        scales: {
                            r: { beginAtZero: true, max: 100 }
                        }
                    }
                });
            }
            
            // Agent performance chart
            const agentCtx = document.getElementById('agentChart')?.getContext('2d');
            if (agentCtx) {
                agentChart = new Chart(agentCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Auth', 'Estate', 'Vault', 'Compliance', 'Notify', 'LLM', 'Admin'],
                        datasets: [{
                            label: 'Hours Spent',
                            data: [30, 80, 45, 10, 15, 8, 60],
                            backgroundColor: '#D4AF37',
                        }, {
                            label: 'Commits',
                            data: [15, 45, 25, 5, 8, 4, 35],
                            backgroundColor: '#1e3a8a',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'top' } }
                    }
                });
            }
            
            // Time distribution chart
            const timeCtx = document.getElementById('timeDistChart')?.getContext('2d');
            if (timeCtx) {
                timeDistChart = new Chart(timeCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Avg Hours',
                            data: [5.2, 6.1, 4.8, 5.5, 4.2, 2.1, 1.5],
                            backgroundColor: [
                                '#D4AF37', '#D4AF37', '#D4AF37', '#D4AF37', '#D4AF37',
                                'rgba(212, 175, 55, 0.5)', 'rgba(212, 175, 55, 0.3)'
                            ],
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true, max: 8 } }
                    }
                });
            }
        }
        
        window.updateAnalytics = function() {
            const range = document.getElementById('timeRange').value;
            console.log('Update analytics for', range, 'days');
            // Would fetch new data and update charts
        };
        
        window.exportAnalytics = function() {
            showToast('Generating analytics report...', 'info');
            setTimeout(() => {
                showToast('Analytics report exported', 'success');
            }, 1500);
        };
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
