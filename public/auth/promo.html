<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Offer - Legacy Estate OS</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-navy: #0f172a;
            --color-royal: #1e3a8a;
            --color-gold: #C8A951;
            --color-gold-bright: #D4B85A;
            --color-emerald: #10B981;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 50% 0%, #2563eb 0%, #1e3a8a 40%, #0f172a 80%);
            min-height: 100vh;
        }
        h1, h2, h3 { font-family: 'Cinzel', serif; }
        .glass-card {
            background: rgba(30, 58, 138, 0.5);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-gold {
            background: var(--color-gold);
            color: #000;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            background: var(--color-gold-bright);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }
        .promo-badge {
            background: linear-gradient(135deg, var(--color-gold) 0%, #B8942A 100%);
            color: #000;
            font-weight: 800;
        }
        .countdown { font-variant-numeric: tabular-nums; }
        .status-dot {
            width: 8px; height: 8px;
            background: var(--color-emerald);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }
        .deco-corner {
            position: absolute;
            width: 30px; height: 30px;
            border-color: var(--color-gold);
            opacity: 0.6;
        }
        .deco-corner.top-left { top: 12px; left: 12px; border-top: 2px solid; border-left: 2px solid; }
        .deco-corner.top-right { top: 12px; right: 12px; border-top: 2px solid; border-right: 2px solid; }
        .deco-corner.bottom-left { bottom: 12px; left: 12px; border-bottom: 2px solid; border-left: 2px solid; }
        .deco-corner.bottom-right { bottom: 12px; right: 12px; border-bottom: 2px solid; border-right: 2px solid; }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="glass-card rounded-lg max-w-lg w-full relative overflow-hidden">
        <!-- Deco corners -->
        <div class="deco-corner top-left"></div>
        <div class="deco-corner top-right"></div>
        <div class="deco-corner bottom-left"></div>
        <div class="deco-corner bottom-right"></div>
        
        <!-- Promo Badge -->
        <div class="promo-badge text-center py-2 text-xs tracking-[0.2em]">
            <span id="promo-label">EXCLUSIVE OFFER</span>
        </div>
        
        <div class="p-8">
            <!-- Logo -->
            <div class="flex justify-center mb-4">
                <div class="w-14 h-14 text-[var(--color-gold)]">
                    <svg viewBox="0 0 100 100" class="w-full h-full fill-current">
                        <path d="M50 20 C55 20 58 25 58 30 C58 35 55 38 50 38 C45 38 42 35 42 30 C42 25 45 20 50 20 M50 40 C60 40 70 30 80 15 C85 25 85 45 70 55 L60 60 L65 90 L50 85 L35 90 L40 60 L30 55 C15 45 15 25 20 15 C30 30 40 40 50 40 Z" />
                    </svg>
                </div>
            </div>
            
            <h1 class="text-2xl md:text-3xl text-white text-center mb-2">
                <span id="promo-headline">Save 30% Today</span>
            </h1>
            <p class="text-white/60 text-sm text-center mb-6" id="promo-description">
                Lock in your Concierge membership at our lowest price ever.
            </p>
            
            <!-- Countdown Timer -->
            <div class="flex justify-center gap-4 mb-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-[var(--color-gold)] countdown" id="countdown-hours">23</div>
                    <div class="text-[0.6rem] text-white/50 uppercase tracking-wider">Hours</div>
                </div>
                <div class="text-2xl text-white/30">:</div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-[var(--color-gold)] countdown" id="countdown-minutes">59</div>
                    <div class="text-[0.6rem] text-white/50 uppercase tracking-wider">Minutes</div>
                </div>
                <div class="text-2xl text-white/30">:</div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-[var(--color-gold)] countdown" id="countdown-seconds">59</div>
                    <div class="text-[0.6rem] text-white/50 uppercase tracking-wider">Seconds</div>
                </div>
            </div>
            
            <!-- Promo Code Display -->
            <div class="bg-white/10 border border-white/20 rounded p-3 mb-6 flex items-center justify-between" id="promo-code-box">
                <div>
                    <div class="text-[0.6rem] text-white/50 uppercase tracking-wider">Your Code</div>
                    <div class="text-lg font-bold text-white tracking-widest" id="promo-code-display">LEGACY30</div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="status-dot"></div>
                    <span class="text-xs text-[var(--color-emerald)]">Active</span>
                </div>
            </div>
            
            <!-- Price Comparison -->
            <div class="flex items-center justify-center gap-4 mb-6">
                <div class="text-center">
                    <div class="text-white/40 line-through text-lg">$2,997</div>
                    <div class="text-[0.6rem] text-white/40 uppercase">Regular</div>
                </div>
                <svg class="w-6 h-6 text-[var(--color-gold)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                </svg>
                <div class="text-center">
                    <div class="text-[var(--color-gold)] font-bold text-2xl" id="promo-price">$2,097</div>
                    <div class="text-[0.6rem] text-[var(--color-gold)] uppercase">With Code</div>
                </div>
            </div>
            
            <!-- CTA -->
            <button onclick="claimOffer()" class="btn-gold w-full py-4 rounded text-sm">
                Claim This Offer
            </button>
            
            <!-- Trust indicators -->
            <div class="flex items-center justify-center gap-4 mt-4 text-white/40 text-[0.6rem]">
                <div class="flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <span>256-bit SSL</span>
                </div>
                <div class="flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>30-Day Guarantee</span>
                </div>
            </div>
            
            <p class="text-center text-white/40 text-xs mt-6">
                <a href="/" class="hover:text-white transition-colors">‚Üê Back to Legacy</a>
            </p>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyANMDZXcdn2eI8JN8FxXlAkCt-f4BONuiU",
            authDomain: "legacy-estate-os.firebaseapp.com",
            projectId: "legacy-estate-os",
            storageBucket: "legacy-estate-os.firebasestorage.app",
            messagingSenderId: "1002875213628",
            appId: "1:1002875213628:web:59d3f4b04345f3f7abb039"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Promo configuration - can be fetched from Firestore for dynamic promos
        const promoConfigs = {
            'LEGACY30': { discount: 30, price: '$2,097', headline: 'Save 30% Today', description: 'Lock in your Concierge membership at our lowest price ever.' },
            'LAUNCH50': { discount: 50, price: '$1,499', headline: 'Launch Special: 50% Off', description: 'Be among the first to secure your legacy at half price.' },
            'FRIEND20': { discount: 20, price: '$2,397', headline: 'Friends & Family: 20% Off', description: 'Your referral code is ready to use.' },
            'default': { discount: 0, price: '$2,997', headline: 'Join Legacy Today', description: 'Start protecting your family\'s future.' }
        };

        // Get promo code from URL
        const urlParams = new URLSearchParams(window.location.search);
        const promoCode = (urlParams.get('code') || 'default').toUpperCase();
        const config = promoConfigs[promoCode] || promoConfigs['default'];

        // Update UI with promo details
        document.getElementById('promo-code-display').textContent = promoCode === 'default' ? 'NONE' : promoCode;
        document.getElementById('promo-headline').textContent = config.headline;
        document.getElementById('promo-description').textContent = config.description;
        document.getElementById('promo-price').textContent = config.price;

        if (promoCode === 'default') {
            document.getElementById('promo-label').textContent = 'WELCOME';
            document.getElementById('promo-code-box').style.display = 'none';
        }

        // Store promo code for signup flow
        if (promoCode !== 'default') {
            localStorage.setItem('legacy_promo_code', promoCode);
            localStorage.setItem('legacy_promo_discount', config.discount);
        }

        // Countdown timer (24 hours from first visit or stored expiry)
        let expiryTime = localStorage.getItem('legacy_promo_expiry');
        if (!expiryTime || promoCode !== localStorage.getItem('legacy_promo_code_stored')) {
            expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24 hours
            localStorage.setItem('legacy_promo_expiry', expiryTime);
            localStorage.setItem('legacy_promo_code_stored', promoCode);
        }

        function updateCountdown() {
            const now = Date.now();
            const remaining = Math.max(0, expiryTime - now);
            
            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
            
            document.getElementById('countdown-hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('countdown-minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('countdown-seconds').textContent = String(seconds).padStart(2, '0');
            
            if (remaining > 0) {
                requestAnimationFrame(() => setTimeout(updateCountdown, 1000));
            }
        }
        updateCountdown();

        // Check if user is already logged in
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists() && userDoc.data().subscription?.status === 'active') {
                    window.location.href = '/portals/principal/dashboard.html';
                }
            }
        });

        // Claim offer - redirect to main site with promo context
        window.claimOffer = function() {
            window.location.href = '/?promo=' + promoCode + '#signup';
        };
    </script>
</body>
</html>
