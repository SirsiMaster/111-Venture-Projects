<!DOCTYPE html>
<html lang="en" data-auth-protect="admin">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Estates â€” FinalWishes</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FinalWishes Design System -->
    <link rel="stylesheet" href="../finalwishes.css">
    <link rel="stylesheet" href="../assets/css/admin-layout.css?v=5.0.0">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar Component -->
        <div id="sidebar-root" data-active="estates"></div>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Component -->
            <header id="universal-header-root" 
                    data-title="Estate Management" 
                    data-subtitle="Create, view, and manage all estates"
                    data-search-placeholder="Search estates by name, principal, or state..."></header>
            
            <!-- Page Content -->
            <div class="page-content">
                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button class="btn btn-primary" onclick="showCreateModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                            New Estate
                        </button>
                        <div class="filter-group">
                            <select id="statusFilter" class="form-select" onchange="filterEstates()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="closed">Closed</option>
                            </select>
                            <select id="phaseFilter" class="form-select" onchange="filterEstates()">
                                <option value="">All Phases</option>
                                <option value="planning">Planning</option>
                                <option value="documentation">Documentation</option>
                                <option value="notification">Notification</option>
                                <option value="distribution">Distribution</option>
                                <option value="closing">Closing</option>
                            </select>
                            <select id="stateFilter" class="form-select" onchange="filterEstates()">
                                <option value="">All States</option>
                                <option value="IL">Illinois</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="DC">Washington D.C.</option>
                                <option value="VA">Virginia</option>
                                <option value="MD">Maryland</option>
                            </select>
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-icon" onclick="toggleView('grid')" title="Grid view">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </button>
                        <button class="btn btn-icon active" onclick="toggleView('table')" title="Table view">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                <line x1="3" y1="18" x2="21" y2="18"></line>
                            </svg>
                        </button>
                        <button class="btn btn-secondary" onclick="exportEstates()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                
                <!-- Stats Summary -->
                <div class="stats-grid mini">
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-active">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-pending">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card mini">
                        <div class="stat-value" id="stat-completed">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                
                <!-- Table View -->
                <div class="data-table" id="estates-table-view">
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th onclick="sortBy('name')">Estate Name <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('principalName')">Principal <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('state')">State <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('phase')">Phase <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('status')">Status <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('estimatedValue')">Est. Value <span class="sort-icon">â†•</span></th>
                                <th onclick="sortBy('createdAt')">Created <span class="sort-icon">â†•</span></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="estates-table-body">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: var(--space-xl);">
                                    <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                    <div class="skeleton" style="height: 20px; margin-bottom: 8px;"></div>
                                    <div class="skeleton" style="height: 20px;"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Grid View (hidden by default) -->
                <div class="estates-grid hidden" id="estates-grid-view"></div>
                
                <!-- Pagination -->
                <div class="pagination" id="pagination"></div>
            </div>
        </main>
    </div>
    
    <!-- Create/Edit Estate Modal -->
    <div class="modal" id="estateModal">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Create New Estate</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="estateForm" onsubmit="handleSubmit(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="estateName">Estate Name *</label>
                            <input type="text" id="estateName" name="name" required placeholder="e.g., Smith Family Estate">
                        </div>
                    </div>
                    
                    <h4 class="form-section-title">Principal Information</h4>
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="principalFirstName">First Name *</label>
                            <input type="text" id="principalFirstName" name="principalFirstName" required>
                        </div>
                        <div class="form-group">
                            <label for="principalLastName">Last Name *</label>
                            <input type="text" id="principalLastName" name="principalLastName" required>
                        </div>
                    </div>
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="principalEmail">Email</label>
                            <input type="email" id="principalEmail" name="principalEmail" placeholder="email@example.com">
                        </div>
                        <div class="form-group">
                            <label for="principalPhone">Phone</label>
                            <input type="tel" id="principalPhone" name="principalPhone" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    
                    <h4 class="form-section-title">Estate Details</h4>
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="estateState">State *</label>
                            <select id="estateState" name="state" required>
                                <option value="">Select state</option>
                                <option value="IL">Illinois</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="DC">Washington D.C.</option>
                                <option value="VA">Virginia</option>
                                <option value="MD">Maryland</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="estatePhase">Phase</label>
                            <select id="estatePhase" name="phase">
                                <option value="planning">Planning</option>
                                <option value="documentation">Documentation</option>
                                <option value="notification">Notification</option>
                                <option value="distribution">Distribution</option>
                                <option value="closing">Closing</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="estimatedValue">Estimated Value</label>
                            <input type="number" id="estimatedValue" name="estimatedValue" placeholder="500000" min="0" step="1000">
                        </div>
                        <div class="form-group">
                            <label for="estateStatus">Status</label>
                            <select id="estateStatus" name="status">
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="estateNotes">Notes</label>
                        <textarea id="estateNotes" name="notes" rows="3" placeholder="Additional notes about the estate..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Create Estate</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-backdrop" onclick="closeDeleteModal()"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Deletion</h2>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="deleteEstateName"></strong>?</p>
                <p class="text-muted">This action cannot be undone. All associated documents, assets, and beneficiary data will be permanently removed.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete Estate</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Load Component Scripts -->
    <script src="../components/sidebar.js"></script>
    <script src="../components/universal-header.js"></script>
    
    <!-- Firebase SDK & Estate Logic -->
    <script type="module">
        import { AuthService, DatabaseService } from '../assets/js/firebase-init.js';
        import EstateService from '../assets/js/services/estateService.js';
        
        // Make available globally
        window.AuthService = AuthService;
        window.DatabaseService = DatabaseService;
        window.EstateService = EstateService;
        
        // State
        let estates = [];
        let filteredEstates = [];
        let currentPage = 1;
        let pageSize = 10;
        let sortField = 'createdAt';
        let sortDirection = 'desc';
        let editingEstateId = null;
        let deletingEstateId = null;
        let currentView = 'table';
        
        // Initialize
        async function init() {
            console.log('ðŸ›ï¸ FinalWishes - Estate Management');
            await loadEstates();
        }
        
        // Load estates from Firebase
        async function loadEstates() {
            try {
                estates = await EstateService.getAllEstates();
                filteredEstates = [...estates];
                updateStats();
                renderEstates();
            } catch (error) {
                console.error('Error loading estates:', error);
                showToast('Failed to load estates', 'error');
            }
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('stat-total').textContent = estates.length;
            document.getElementById('stat-active').textContent = estates.filter(e => e.status === 'active').length;
            document.getElementById('stat-pending').textContent = estates.filter(e => e.status === 'pending').length;
            document.getElementById('stat-completed').textContent = estates.filter(e => e.status === 'completed').length;
        }
        
        // Render estates
        function renderEstates() {
            if (currentView === 'table') {
                renderTableView();
            } else {
                renderGridView();
            }
            renderPagination();
        }
        
        // Render table view
        function renderTableView() {
            const tbody = document.getElementById('estates-table-body');
            const start = (currentPage - 1) * pageSize;
            const pageEstates = filteredEstates.slice(start, start + pageSize);
            
            if (pageEstates.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: var(--space-xl);">
                            <div style="color: var(--text-secondary);">
                                ${estates.length === 0 ? 'No estates yet. Click "New Estate" to create your first one.' : 'No estates match your filters.'}
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = pageEstates.map(estate => {
                const createdAt = estate.createdAt?.toDate?.() || new Date(estate.createdAt);
                const dateStr = createdAt.toLocaleDateString();
                const statusClass = getStatusClass(estate.status);
                const phaseClass = getPhaseClass(estate.phase);
                const value = estate.estimatedValue ? '$' + estate.estimatedValue.toLocaleString() : 'â€”';
                
                return `
                    <tr>
                        <td><input type="checkbox" class="estate-checkbox" data-id="${estate.id}"></td>
                        <td>
                            <a href="estate-detail.html?id=${estate.id}" class="estate-link">
                                <strong>${estate.name || 'Unnamed'}</strong>
                            </a>
                        </td>
                        <td>${estate.principalName || 'N/A'}</td>
                        <td>${estate.state || 'N/A'}</td>
                        <td><span class="badge ${phaseClass}">${capitalize(estate.phase || 'planning')}</span></td>
                        <td><span class="badge ${statusClass}">${capitalize(estate.status || 'active')}</span></td>
                        <td>${value}</td>
                        <td>${dateStr}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-sm" onclick="viewEstate('${estate.id}')" title="View">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                <button class="btn btn-icon btn-sm" onclick="editEstate('${estate.id}')" title="Edit">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                                <button class="btn btn-icon btn-sm btn-danger" onclick="deleteEstate('${estate.id}', '${estate.name}')" title="Delete">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Render grid view
        function renderGridView() {
            const grid = document.getElementById('estates-grid-view');
            const start = (currentPage - 1) * pageSize;
            const pageEstates = filteredEstates.slice(start, start + pageSize);
            
            if (pageEstates.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <p>${estates.length === 0 ? 'No estates yet.' : 'No estates match your filters.'}</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = pageEstates.map(estate => {
                const statusClass = getStatusClass(estate.status);
                const phaseClass = getPhaseClass(estate.phase);
                const value = estate.estimatedValue ? '$' + estate.estimatedValue.toLocaleString() : 'N/A';
                
                return `
                    <div class="estate-card" onclick="viewEstate('${estate.id}')">
                        <div class="estate-card-header">
                            <h3>${estate.name || 'Unnamed'}</h3>
                            <span class="badge ${statusClass}">${capitalize(estate.status || 'active')}</span>
                        </div>
                        <div class="estate-card-body">
                            <div class="estate-detail">
                                <span class="label">Principal:</span>
                                <span>${estate.principalName || 'N/A'}</span>
                            </div>
                            <div class="estate-detail">
                                <span class="label">State:</span>
                                <span>${estate.state || 'N/A'}</span>
                            </div>
                            <div class="estate-detail">
                                <span class="label">Phase:</span>
                                <span class="badge ${phaseClass}">${capitalize(estate.phase || 'planning')}</span>
                            </div>
                            <div class="estate-detail">
                                <span class="label">Est. Value:</span>
                                <span>${value}</span>
                            </div>
                        </div>
                        <div class="estate-card-footer">
                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); editEstate('${estate.id}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteEstate('${estate.id}', '${estate.name}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredEstates.length / pageSize);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = `
                <button class="btn btn-sm btn-secondary" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">Previous</button>
                <span class="pagination-info">Page ${currentPage} of ${totalPages}</span>
                <button class="btn btn-sm btn-secondary" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">Next</button>
            `;
            pagination.innerHTML = html;
        }
        
        // Filter estates
        window.filterEstates = function() {
            const status = document.getElementById('statusFilter').value;
            const phase = document.getElementById('phaseFilter').value;
            const state = document.getElementById('stateFilter').value;
            
            filteredEstates = estates.filter(estate => {
                if (status && estate.status !== status) return false;
                if (phase && estate.phase !== phase) return false;
                if (state && estate.state !== state) return false;
                return true;
            });
            
            currentPage = 1;
            renderEstates();
        };
        
        // Sort estates
        window.sortBy = function(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }
            
            filteredEstates.sort((a, b) => {
                let aVal = a[field] || '';
                let bVal = b[field] || '';
                
                if (field === 'estimatedValue') {
                    aVal = Number(aVal) || 0;
                    bVal = Number(bVal) || 0;
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            renderEstates();
        };
        
        // Toggle view
        window.toggleView = function(view) {
            currentView = view;
            document.getElementById('estates-table-view').classList.toggle('hidden', view !== 'table');
            document.getElementById('estates-grid-view').classList.toggle('hidden', view !== 'grid');
            
            document.querySelectorAll('.toolbar-right .btn-icon').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.btn-icon').classList.add('active');
            
            renderEstates();
        };
        
        // Pagination
        window.goToPage = function(page) {
            currentPage = page;
            renderEstates();
        };
        
        // Toggle select all
        window.toggleSelectAll = function() {
            const checked = document.getElementById('selectAll').checked;
            document.querySelectorAll('.estate-checkbox').forEach(cb => {
                cb.checked = checked;
            });
        };
        
        // Show create modal
        window.showCreateModal = function() {
            editingEstateId = null;
            document.getElementById('modalTitle').textContent = 'Create New Estate';
            document.getElementById('submitBtn').textContent = 'Create Estate';
            document.getElementById('estateForm').reset();
            document.getElementById('estateModal').classList.add('open');
        };
        
        // Edit estate
        window.editEstate = function(id) {
            const estate = estates.find(e => e.id === id);
            if (!estate) return;
            
            editingEstateId = id;
            document.getElementById('modalTitle').textContent = 'Edit Estate';
            document.getElementById('submitBtn').textContent = 'Save Changes';
            
            // Populate form
            document.getElementById('estateName').value = estate.name || '';
            const nameParts = (estate.principalName || '').split(' ');
            document.getElementById('principalFirstName').value = nameParts[0] || '';
            document.getElementById('principalLastName').value = nameParts.slice(1).join(' ') || '';
            document.getElementById('principalEmail').value = estate.principalEmail || '';
            document.getElementById('principalPhone').value = estate.principalPhone || '';
            document.getElementById('estateState').value = estate.state || '';
            document.getElementById('estatePhase').value = estate.phase || 'planning';
            document.getElementById('estimatedValue').value = estate.estimatedValue || '';
            document.getElementById('estateStatus').value = estate.status || 'active';
            document.getElementById('estateNotes').value = estate.notes || '';
            
            document.getElementById('estateModal').classList.add('open');
        };
        
        // View estate
        window.viewEstate = function(id) {
            window.location.href = `estate-detail.html?id=${id}`;
        };
        
        // Delete estate
        window.deleteEstate = function(id, name) {
            deletingEstateId = id;
            document.getElementById('deleteEstateName').textContent = name;
            document.getElementById('deleteModal').classList.add('open');
        };
        
        // Confirm delete
        window.confirmDelete = async function() {
            if (!deletingEstateId) return;
            
            try {
                await EstateService.deleteEstate(deletingEstateId);
                showToast('Estate deleted successfully', 'success');
                closeDeleteModal();
                await loadEstates();
            } catch (error) {
                console.error('Error deleting estate:', error);
                showToast('Failed to delete estate', 'error');
            }
        };
        
        // Close modals
        window.closeModal = function() {
            document.getElementById('estateModal').classList.remove('open');
            editingEstateId = null;
        };
        
        window.closeDeleteModal = function() {
            document.getElementById('deleteModal').classList.remove('open');
            deletingEstateId = null;
        };
        
        // Handle form submit
        window.handleSubmit = async function(event) {
            event.preventDefault();
            
            const form = event.target;
            const data = {
                name: form.name.value,
                principalName: `${form.principalFirstName.value} ${form.principalLastName.value}`.trim(),
                principalEmail: form.principalEmail.value,
                principalPhone: form.principalPhone.value,
                state: form.state.value,
                phase: form.phase.value,
                estimatedValue: Number(form.estimatedValue.value) || 0,
                status: form.status.value,
                notes: form.notes.value,
            };
            
            try {
                if (editingEstateId) {
                    await EstateService.updateEstate(editingEstateId, data);
                    showToast('Estate updated successfully', 'success');
                } else {
                    await EstateService.createEstate(data);
                    showToast('Estate created successfully', 'success');
                }
                
                closeModal();
                await loadEstates();
            } catch (error) {
                console.error('Error saving estate:', error);
                showToast('Failed to save estate', 'error');
            }
        };
        
        // Export estates
        window.exportEstates = function() {
            const csv = [
                ['Name', 'Principal', 'State', 'Phase', 'Status', 'Estimated Value', 'Created'].join(','),
                ...filteredEstates.map(e => [
                    e.name,
                    e.principalName,
                    e.state,
                    e.phase,
                    e.status,
                    e.estimatedValue,
                    e.createdAt?.toDate?.().toISOString() || ''
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `estates-export-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        };
        
        // Utility functions
        function capitalize(str) {
            return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
        }
        
        function getStatusClass(status) {
            const map = {
                active: 'badge-success',
                pending: 'badge-warning',
                completed: 'badge-info',
                closed: 'badge-neutral',
            };
            return map[status] || 'badge-neutral';
        }
        
        function getPhaseClass(phase) {
            const map = {
                planning: 'badge-gold',
                documentation: 'badge-info',
                notification: 'badge-warning',
                distribution: 'badge-success',
                closing: 'badge-neutral',
            };
            return map[phase] || 'badge-neutral';
        }
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // Initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
